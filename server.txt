const express = require('express');
const app = express();
const cors = require('cors');
const mongoose = require('mongoose');
const StudentdataModel = require('./models/Studentdata');

require("dotenv").config();

var bodyParser = require('body-parser')

app.use(cors());
app.use(bodyParser.json({limit: "50mb"}));
app.use(bodyParser.urlencoded({limit: "50mb", extended: true, parameterLimit:50000}));


mongoose.connect(
    "mongodb+srv://dbadmin:knk2121@cluster0.aifbbb9.mongodb.net/?retryWrites=true&w=majority",
  { useNewUrlParser: true, useUnifiedTopology: true }
);


app.get("api/v1/data/read", async (req, res) => {
    try {
      const result = await StudentdataModel.find({});
      res.send(result);
    } catch (err) {
      res.send(err);
    }
  });
  


app.post("api/v1/data/post", async (req,res) => {
  console.log("GEWRE")

  console.log(req)
  const name= req.body.name;
  const code= req.body.code;
  const phoneNumber= req.body.phoneNumber;

//   const ADMISSION_NUMBER = req.body.ADMISSION_NUMBER;
//   const Student_Name = req.body.Student_Name;
//   const Father_Name = req.body.Father_Name;
//   const Mother_Name = req.body.Mother_name ;
//   const Date_of_Birth = req.body.Date_of_Birth;
//   const Mobile_No = req.body.Date_of_Birth;
// console.log(ADMISSION_NUMBER)

    // const user = new StudentdataModel({ADMISSION_NUMBER:ADMISSION_NUMBER, name: Student_Name, Father_Name:Father_Name, Mother_Name: Mother_Name,Date_of_Birth:Date_of_Birth,Mobile_No:Mobile_No });
    const user = new StudentdataModel({ADMISSION_NUMBER:ADMISSION_NUMBER, name: Student_Name, Father_Name:Father_Name, Mother_Name: Mother_Name,Date_of_Birth:Date_of_Birth,Mobile_No:Mobile_No });
    await user.save()
    .then("hai")
    res.send('Success of user login');
    console.log("DONE LOGIN")

})




  
let port = process.env.PORT || 8001;

app.listen(port, () => {
    console.log("App is running on port " + port);
});



















const express = require('express');
const app = express();
const cors = require('cors');
const mongoose = require('mongoose');
const StudentModel = require('./models/Studentdata');

require("dotenv").config();

var bodyParser = require('body-parser');

app.use(cors());
app.use(bodyParser.json({ limit: "50mb" }));
app.use(bodyParser.urlencoded({ limit: "50mb", extended: true, parameterLimit: 50000 }));

mongoose.connect("mongodb+srv://dbadmin:knk2121@cluster0.aifbbb9.mongodb.net/?retryWrites=true&w=majority", { useNewUrlParser: true, useUnifiedTopology: true })
  .then(() => {
    console.log('Connected to MongoDB');
  })
  .catch((error) => {
    console.error('Error connecting to MongoDB:', error);
  });

app.get("http://192.168.137.237:3000/app/v1/post", async (req, res) => {
  try {
    const result = await StudentModel.find({});
    res.send(result);
  } catch (err) {
    res.send(err);
  }
});

app.post("http://192.168.137.237:3000/app/v1/post", async (req, res) => {
  const {
    ADMISSION_NUMBER,
    Student_Name,
    Father_Name,
    Mother_name,
    Date_of_Birth,
    Mobile_No
  } = req.body;

  const student = new StudentModel({
    ADMISSION_NUMBER,
    Student_Name,
    Father_Name,
    Mother_name,
    Date_of_Birth,
    Mobile_No
  });

  try {
    await student.save();
    res.send('Success of user login');
  } catch (err) {
    res.send(err);
  }
});

const port = process.env.PORT || 3000;

app.listen(port, () => {
  console.log("App is running on port " + port);
});